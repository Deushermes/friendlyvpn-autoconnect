<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Subscription URL</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
        }
        .result { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            white-space: pre-wrap; 
            word-break: break-all; 
        }
        .error { 
            background: #f8d7da; 
            border-color: #f5c6cb; 
            color: #721c24; 
        }
        .success { 
            background: #d4edda; 
            border-color: #c3e6cb; 
            color: #155724; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Subscription URL</h1>
        
        <div>
            <label>–í–≤–µ–¥–∏—Ç–µ subscription URL:</label>
            <input type="text" id="subscriptionUrl" placeholder="https://myfriendlyvpntest.duckdns.org/sub/..." 
                   value="https://myfriendlyvpntest.duckdns.org/sub/dXNlcl8zNzEwOTEyMzNfMTc1MTc5NzQ5MywxNzUxODIwMzIzIapPvZX5A0">
        </div>
        
        <button onclick="analyzeSubscription()">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        <button onclick="testInStreisand()">üì± –¢–µ—Å—Ç –≤ Streisand</button>
        <button onclick="clearResults()">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
        
        <div id="results"></div>
    </div>

    <script>
        async function analyzeSubscription() {
            const url = document.getElementById('subscriptionUrl').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!url) {
                addResult('‚ùå –í–≤–µ–¥–∏—Ç–µ URL', 'error');
                return;
            }
            
            addResult(`üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º: ${url}`, 'info');
            
            try {
                // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ subscription URL
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'User-Agent': 'clash-verge/v1.3.1'  // –ò–º–∏—Ç–∏—Ä—É–µ–º VPN –∫–ª–∏–µ–Ω—Ç
                    }
                });
                
                addResult(`üìä HTTP Status: ${response.status} ${response.statusText}`, 
                         response.ok ? 'success' : 'error');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                
                addResult(`üìã Headers:\n${JSON.stringify(headers, null, 2)}`, 'info');
                
                if (response.ok) {
                    // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    const text = await response.text();
                    
                    addResult(`üìÑ Content Length: ${text.length} —Å–∏–º–≤–æ–ª–æ–≤`, 'info');
                    addResult(`üìù Raw Content:\n${text}`, 'info');
                    
                    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    analyzeContent(text);
                } else {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ HTTP: ${response.status}`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
            }
        }
        
        function analyzeContent(content) {
            addResult('üîç –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
            if (content.startsWith('vless://')) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: –ü—Ä—è–º–∞—è VLESS —Å—Å—ã–ª–∫–∞', 'success');
                analyzeVlessUrl(content);
            } else if (content.startsWith('vmess://')) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: –ü—Ä—è–º–∞—è VMess —Å—Å—ã–ª–∫–∞', 'success');
            } else if (content.startsWith('trojan://')) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: –ü—Ä—è–º–∞—è Trojan —Å—Å—ã–ª–∫–∞', 'success');
            } else if (isBase64(content)) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: Base64 –∫–æ–¥–∏—Ä–æ–≤–∫–∞', 'success');
                try {
                    const decoded = atob(content.trim());
                    addResult(`üìù –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:\n${decoded}`, 'info');
                    analyzeContent(decoded);
                } catch (e) {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64', 'error');
                }
            } else if (content.includes('proxies:') || content.includes('proxy-groups:')) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Clash)', 'success');
            } else if (content.startsWith('{')) {
                addResult('‚úÖ –§–æ—Ä–º–∞—Ç: JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è', 'success');
            } else {
                addResult('‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ', 'error');
            }
        }
        
        function analyzeVlessUrl(vlessUrl) {
            try {
                const url = new URL(vlessUrl);
                const params = new URLSearchParams(url.search);
                
                addResult(`üîó VLESS –∞–Ω–∞–ª–∏–∑:
–ü—Ä–æ—Ç–æ–∫–æ–ª: ${url.protocol}
UUID: ${url.username}
–°–µ—Ä–≤–µ—Ä: ${url.hostname}:${url.port}
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: ${params.get('security') || 'none'}
–¢–∏–ø: ${params.get('type') || 'tcp'}
Flow: ${params.get('flow') || 'none'}
SNI: ${params.get('sni') || 'none'}
Fingerprint: ${params.get('fp') || 'none'}`, 'success');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Streisand
                const security = params.get('security');
                const flow = params.get('flow');
                
                if (security === 'reality') {
                    addResult('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: Streisand –º–æ–∂–µ—Ç –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å Reality –ø—Ä–æ—Ç–æ–∫–æ–ª!', 'error');
                    addResult('üí° –†–µ—à–µ–Ω–∏–µ: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Shadowrocket –∏–ª–∏ v2rayN', 'info');
                }
                
                if (flow && flow.includes('xtls')) {
                    addResult('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: XTLS flow –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏', 'error');
                }
                
            } catch (e) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ VLESS URL: ${e.message}`, 'error');
            }
        }
        
        function isBase64(str) {
            try {
                return btoa(atob(str)) === str;
            } catch (err) {
                return false;
            }
        }
        
        function testInStreisand() {
            const url = document.getElementById('subscriptionUrl').value.trim();
            if (!url) {
                addResult('‚ùå –í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            const streisandUrl = `streisand://import/${encodeURIComponent(url)}`;
            addResult(`üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ Streisand: ${streisandUrl}`, 'info');
            
            try {
                window.location.href = streisandUrl;
            } catch (e) {
                addResult(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        function addResult(text, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            resultsDiv.appendChild(div);
            
            // –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑
            div.scrollIntoView({ behavior: 'smooth' });
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            if (url) {
                document.getElementById('subscriptionUrl').value = decodeURIComponent(url);
                analyzeSubscription();
            }
        });
    </script>
</body>
</html>

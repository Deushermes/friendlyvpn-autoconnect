<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN –¥–ª—è iOS</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }
        .step {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
        }
        .step-number {
            background: #007AFF;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 14px;
        }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
            width: 100%;
            box-sizing: border-box;
        }
        .btn:hover {
            background: #0056CC;
            transform: translateY(-2px);
        }
        .btn-success {
            background: #34C759;
        }
        .btn-success:hover {
            background: #28A745;
        }
        .btn-secondary {
            background: #8E8E93;
        }
        .btn-secondary:hover {
            background: #6D6D70;
        }
        .config-box {
            background: #f0f0f0;
            border: 2px dashed #007AFF;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            margin: 15px 0;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
        .config-box.show {
            display: block;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        .qr-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
            display: none;
        }
        .qr-container.show {
            display: block;
        }
        .instruction {
            background: #e7f3ff;
            border-left: 4px solid #007AFF;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .warning {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="logo">üì±</div>
        <h1>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN –¥–ª—è iOS</h1>
        
        <div id="status" class="status info">
            ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VPN...
        </div>

        <!-- –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <div class="step">
            <span class="step-number">1</span>
            <strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Streisand</strong><br>
            <small>–°–∫–∞—á–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ App Store</small>
        </div>

        <button class="btn" onclick="downloadApp()">
            üì≤ –û—Ç–∫—Ä—ã—Ç—å App Store
        </button>

        <!-- –®–∞–≥ 2: QR-–∫–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±) -->
        <div class="step">
            <span class="step-number">2</span>
            <strong>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥</strong><br>
            <small>–°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</small>
        </div>

        <button class="btn btn-success" onclick="showQR()" id="qrBtn" disabled>
            üì± –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥
        </button>

        <div id="qr-container" class="qr-container">
            <div id="qr-code"></div>
            <div class="instruction">
                <strong>üìñ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å QR-–∫–æ–¥:</strong><br>
                1. –û—Ç–∫—Ä–æ–π—Ç–µ Streisand<br>
                2. –ù–∞–∂–º–∏—Ç–µ "+" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É<br>
                3. –í—ã–±–µ—Ä–∏—Ç–µ "Scan QR Code"<br>
                4. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∫–æ–¥ –≤—ã—à–µ<br>
                5. –ù–∞–∂–º–∏—Ç–µ "Connect"
            </div>
        </div>

        <!-- –®–∞–≥ 3: –†—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
        <div class="step">
            <span class="step-number">3</span>
            <strong>–†—É—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</strong><br>
            <small>–ï—Å–ª–∏ QR-–∫–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</small>
        </div>

        <button class="btn btn-secondary" onclick="showConfig()" id="configBtn" disabled>
            üìã –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        </button>

        <div id="config-box" class="config-box"></div>

        <button class="btn" onclick="copyConfig()" id="copyBtn" style="display: none;">
            üìù –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        </button>

        <div class="instruction" style="display: none;" id="manual-instruction">
            <strong>üìñ –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:</strong><br>
            1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—ã—à–µ<br>
            2. –û—Ç–∫—Ä–æ–π—Ç–µ Streisand<br>
            3. –ù–∞–∂–º–∏—Ç–µ "+" ‚Üí "Import from Clipboard"<br>
            4. –ù–∞–∂–º–∏—Ç–µ "Connect"
        </div>

        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
        <div class="warning">
            ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫–∏ –≤ iOS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ QR-–∫–æ–¥ –∏–ª–∏ —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <button class="btn btn-secondary" onclick="goBack()" style="margin-top: 20px;">
            üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç
        </button>
    </div>

    <script>
        let subscriptionUrl = null;

        // –ü–æ–ª—É—á–∞–µ–º URL –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        function initializePage() {
            const urlParams = new URLSearchParams(window.location.search);
            subscriptionUrl = urlParams.get('url');
            
            console.log('URL Parameters:', window.location.search);
            console.log('Subscription URL:', subscriptionUrl);
            
            if (subscriptionUrl) {
                try {
                    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º URL –µ—Å–ª–∏ –æ–Ω –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω
                    subscriptionUrl = decodeURIComponent(subscriptionUrl);
                    console.log('Decoded URL:', subscriptionUrl);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
                    if (subscriptionUrl.startsWith('vless://')) {
                        document.getElementById('status').innerHTML = '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VLESS –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
                        document.getElementById('status').className = 'status success';
                    } else {
                        document.getElementById('status').innerHTML = '‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏';
                        document.getElementById('status').className = 'status warning';
                    }
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                    document.getElementById('qrBtn').disabled = false;
                    document.getElementById('configBtn').disabled = false;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                    document.getElementById('config-box').textContent = subscriptionUrl;
                    
                } catch (e) {
                    console.error('URL decode error:', e);
                    showError('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏');
                }
            } else {
                showError('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ URL');
            }
        }

        function showError(message) {
            document.getElementById('status').innerHTML = `‚ùå ${message}`;
            document.getElementById('status').className = 'status error';
        }

        function downloadApp() {
            console.log('Opening App Store...');
            window.open('https://apps.apple.com/ru/app/streisand/id6450534064', '_blank');
        }

        function showQR() {
            if (!subscriptionUrl) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                return;
            }

            console.log('Generating QR code for:', subscriptionUrl);
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π QR-–∫–æ–¥
            document.getElementById('qr-code').innerHTML = '';
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥
            QRCode.toCanvas(document.getElementById('qr-code'), subscriptionUrl, {
                width: 280,
                height: 280,
                colorDark: '#000000',
                colorLight: '#ffffff',
                margin: 2,
                errorCorrectionLevel: 'M'
            }, function (error) {
                if (error) {
                    console.error('QR code generation error:', error);
                    alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.');
                } else {
                    console.log('QR code generated successfully');
                    document.getElementById('qr-container').classList.add('show');
                    
                    // –°–∫—Ä–æ–ª–ª–∏–º –∫ QR-–∫–æ–¥—É
                    document.getElementById('qr-container').scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            });
        }

        function showConfig() {
            if (!subscriptionUrl) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                return;
            }

            document.getElementById('config-box').classList.add('show');
            document.getElementById('copyBtn').style.display = 'block';
            document.getElementById('manual-instruction').style.display = 'block';
            
            // –°–∫—Ä–æ–ª–ª–∏–º –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            document.getElementById('config-box').scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }

        function copyConfig() {
            if (!subscriptionUrl) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }

            console.log('Copying config to clipboard...');
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(subscriptionUrl).then(() => {
                    alert('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!\n\n–¢–µ–ø–µ—Ä—å:\n1. –û—Ç–∫—Ä–æ–π—Ç–µ Streisand\n2. –ù–∞–∂–º–∏—Ç–µ "+"\n3. –í—ã–±–µ—Ä–∏—Ç–µ "Import from Clipboard"\n4. –ù–∞–∂–º–∏—Ç–µ "Connect"');
                }).catch((error) => {
                    console.error('Clipboard error:', error);
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
        }

        function fallbackCopy() {
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            const textArea = document.createElement('textarea');
            textArea.value = subscriptionUrl;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!\n\n–û—Ç–∫—Ä–æ–π—Ç–µ Streisand –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞.');
            } catch (err) {
                console.error('Fallback copy failed:', err);
                alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –í—ã–¥–µ–ª–∏—Ç–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é.');
            }
            
            document.body.removeChild(textArea);
        }

        function goBack() {
            // –í–æ–∑–≤—Ä–∞—Ç –≤ Telegram –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            } else {
                window.history.back();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('Page became visible - user returned from app');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
